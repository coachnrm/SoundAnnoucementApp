@page "/queuecontrol"
@using Microsoft.AspNetCore.SignalR.Client
@inject NavigationManager Navigation

<h3>Queue Control</h3>

<button class="btn btn-primary" @onclick="() => CallQueue()">üì¢ ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏Ñ‡∏¥‡∏ß</button>
<button class="btn btn-warning" @onclick="() => SkipQueue()">‚è≠ ‡∏Ç‡πâ‡∏≤‡∏°‡∏Ñ‡∏¥‡∏ß</button>
<button class="btn btn-success" @onclick="() => FinishQueue()">‚úÖ ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</button>

@code {
    private HubConnection? hubConnection;

    protected override async Task OnInitializedAsync()
    {
        hubConnection = new HubConnectionBuilder()
            .WithUrl(Navigation.ToAbsoluteUri("/queuehub"))
            .WithAutomaticReconnect()
            .Build();

        await hubConnection.StartAsync();
    }

    private async Task CallQueue()
    {
        await hubConnection!.InvokeAsync("CallQueue", "12345", "OPD-20250902", "OPD");
    }

    private async Task SkipQueue()
    {
        await hubConnection!.InvokeAsync("SkipQueue", "12345", "Patient not available");
    }

    private async Task FinishQueue()
    {
        await hubConnection!.InvokeAsync("FinishQueue", "12345");
    }
}
